<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>product-detail</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"  />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css" />
		<link rel="stylesheet" type="text/css" href="../css/own.css" />
		<link rel="stylesheet" type="text/css" href="../css/previewimage.css" />
		<style type="text/css">
			body,p{
				padding: 0;
				margin: 0;
				font-size: 12px;
			}
			.recommend{
				margin: 5px 3px;
				padding: 0px;
			}
			.recommend .mui-table-view{
				margin: 0px !important;
				padding: 0 !important;
				background: none;
			}
			.mui-table-view:after,.recommend .mui-table-view:before{
				border: 0;
				height: 0;
				background-color: #fff;
			}
			.recommend .goods-list{
				margin: 0 !important;
				padding: 2px 4px !important;
			}
			
			.recommend .goods-list-item {
				border-radius: 3px;
				background: #fff;
				padding-top: 3px;
			}
			
			.recommend .goods-list-item img {
				width: 100%;
				max-height: 100px;
				border-radius: 3px;
			}
			
			.recommend .mui-table-view-cell .mui-media-body {
				margin-top: 2px;
				margin-bottom: 0px;
				height: 50px !important;
			}
			
			.recommend .mui-table-view-cell .mui-media-body p {
				white-space: pre;
				color: #555;
				padding: 0 5px;
				white-space:nowrap; 
			    text-overflow:ellipsis; 
			    overflow:hidden;
			}
			
			.recommend .mui-table-view-cell .mui-media-body .goods-price-one {
				margin-top: 12px;
				float: left;
				font-size: 1.1em;
				color: #ff6633;
				margin-bottom: 10px;
			}
			.recommend .mui-table-view-cell .mui-media-body .goods-price-two {
				margin-top: 12px;
				float: right;
				font-size: 1.1em;
				margin-right: 5px;
				text-decoration: line-through;
			}
			#no-item{
				text-align: center;
				color: #DD4F43;
				width: 100%;
				margin: 0;
				padding: 10px 0 0 0;
			}
			.ad{
				display: block;
			}
			.ad img{
				width: 100%;
			}
			
		</style>
	</head>

	<body>
		<div id="content" class="mui-content  detail-content-padding">
			<div class="mui-content recommend">
				<ul class="mui-table-view mui-grid-view" id="list">
				</ul>
			</div>
		</div>
		<script type="text/javascript" src="../js/mui.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/common.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.lazyload.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.lazyload.img.js" charset="UTF-8"></script>
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: false,
				pullRefresh: {
					container: '#content',
					down: {
						style:'circle',//必选，下拉刷新样式，目前支持原生5+ ‘circle’ 样式
					    color:'#41cea9',
					    height:'80px',
						callback: refresh
					},
					up: {
						auto:false,
						height:80,
						contentnomore:honey.contentnomore,
						callback: ajaxGetData //上拉加载具体业务实现
					}
				}
			});
			var count=0;
			mui.ready(function(){
				honey.content=mui('#content')
				honey.list=document.getElementById('list'),
				honey.sort="default";
				honey.desc="";
			})
			mui.plusReady(function() {
				if(!honey.goodsListHeader) {
					honey.goodsListHeader = plus.webview.getWebviewById('goods-list-header');
				}
				mui('#list').on('tap','a',function(){
					var goods_id = this.getAttribute('goods_id');
					if(!honey.detailWebView) {
						honey.detailWebView = plus.webview.getWebviewById('goods-header');
					}
					if(!honey.detailSubpage) {
						honey.detailSubpage = plus.webview.getWebviewById('goods-detail');
					}
					mui.fire(honey.detailWebView, 'goodsId', {
						goods_id:goods_id
					})
					honey.detailWebView.show('slide-in-right', 300)
				})
			})
			
			window.addEventListener('showGoodsList',function(e){
				honey.list.innerHTML='';
				honey.content.pullRefresh().refresh(true);
				honey.page=1;
				honey.total=0;
				honey.cate=e.detail.cate;
				honey.sort="";
				honey.desc="";
				ajaxGetData()
			})
			
			window.addEventListener('GoodsListSort',function(e){
				if(honey.sort!=e.detail.sort || honey.desc!=e.detail.desc){
					if(honey.page>1 && honey.total==0){
						return
					}
					honey.content.pullRefresh().refresh(true);
					honey.sort=e.detail.sort;
					honey.desc=e.detail.desc;
					honey.page=1;
					honey.total=0;
					ajaxGetData()
				}
			})
			
			function refresh(){
				honey.content.pullRefresh().refresh(true);
				honey.page=1;
				honey.total=0;
				ajaxGetData()
			}
			
			function ajaxGetData(o){
				if(honey.page>1 &&(honey.page*honey.pageSize>=honey.total)){
					honey.content.pullRefresh().endPullupToRefresh(true)
				}else{
					mui.ajax(apiurl,{
						data:{m:'goods_list',page:honey.page,size:honey.pageSize,cate:honey.cate,sort:honey.sort,desc:honey.desc},
						type:'post',
						dataType:'json',
						success:function(ret){
							if(honey.page==1){
								honey.list.innerHTML='';
							}
							if(ret.code==0){
								if(honey.page==1 && ret.data.length==0){
									var obj=document.getElementById('list');
									obj.innerHTML="<li class='mui-table-view-cell' id='no-item' style='text'>没有找到相关商品</li>";
								}else{
									showGoodsList(ret.data,'list',(honey.page>1),honey.page<3?{src:'../images/ad'+honey.page+'.jpg'}:false)
								}
								honey.total=ret.total;
								honey.content.pullRefresh().endPullupToRefresh((honey.page*honey.pageSize>=ret.total))
								honey.content.pullRefresh().endPulldownToRefresh();
								honey.page+=1;
							}
						},
						error:function(ret){
							alert(JSON.stringify(ret))
							mui.toast('数据加载失败')
						} 
					})
				}
			}
			
		</script>
	</body>

</html>