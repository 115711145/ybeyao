<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>商品详情</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css" />
		<link rel="stylesheet" type="text/css" href="../css/own.css" />
		<link rel="stylesheet" type="text/css" href="../css/previewimage.css" />
		<link rel="stylesheet" type="text/css" href="../css/goods-detail.css" />
	</head>

	<body id="body">
		<header class="mui-bar mui-bar-nav" id="header">
			<span class="active" index="1">商品</span> <span index="2">详情</span> <span index="3">评论</span>
		</header>
		<div id="detailcontent" class="mui-content  detail-content-padding">
			<div id="attr">
				<div class="goods-title">
					<div class="fl title">
						<h5 id="goods_title"></h5></div>
					<div class="fr icon">
						<!--<a href="#" id="share">
		                    <span class="mui-icon-extra mui-icon-extra-share fl"></span>
		                    <span class="fr">分享</span>
		            	</a>-->
					</div>
				</div>
				<div class="goods-attr">
					<div class="price">
						<p class="goods-price goods-price-one"><span class="icon-money">￥</span><span id="shop_price">0.00</span></p>
						<p class="goods-price goods-price-two">价格 <span id="market_price">￥0.00</span></p>
						<p class="goods-price">可使用积分 <span id="points">0</span></p>
					</div>
					<div class="express">
						<p>
							<span>快递:<font>0.00</font></span>
							<span style="text-align: center;">销量:<font id="sale_num">0</font>笔</span>
							<span style="text-align: right;">库存:<font id="store">0</font></span>
						</p>
					</div>
				</div>
				<div class="user-do choose-type" id="spec">
					<!--<p>
					<span>套餐</span>
					<button type="button" class="mui-btn mui-btn-active">
						套餐一
					</button>
					<button type="button" class="mui-btn">
						套餐二
					</button>
					<button type="button" class="mui-btn">
						套餐三
					</button>
					<button type="button" class="mui-btn">
						套餐四
					</button>
					</p>-->
				</div>
				<div class="user-do" id="buy-number">
					<span>数量</span>
					<div class="mui-numbox">
						<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>
						<input class="mui-input-numbox" type="number" min="1" max="100" id="buy-num" />
						<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>
					</div>
				</div>
				<div class="remark price-ladder" id="price-ladder">
					<div class="attr-table">
						<div class="service">
							<p>活动优惠</p>
							<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
						</div>
					</div>
					<p class="ladder-list" id="ladder-list">
					</p>
				</div>
				<div class="preferential">
					<div class="service" id="attr-express">
						<p><span class="mui-icon mui-icon-checkmarkempty"></span>配送到家</p>
						<p><span class="mui-icon mui-icon-checkmarkempty"></span>药店自取</p>
						<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
					</div>
					<div class="service">
						<p class="point">
							<icon>积分</icon>购买可得
							<font id="give_integral">0</font>积分</p>
						<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
					</div>
				</div>
				<div class="remark">
					<div class="attr-table">
						<div class="service">
							<p>产品简介</p>
							<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
						</div>
					</div>
					<p id="remark">暂无简介
					</p>
				</div>
				<div class="parameter" id="param">
					<div class="attr-table">
						<div class="service">
							<p>产品参数</p>
							<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
						</div>
						<table id="goods-attr-table">
						</table>
					</div>
				</div>
			</div>
			<div class="remark" id="goods-content">
				<div class="attr-table">
					<div class="service">
						<p>详情</p>
						<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
					</div>
				</div>
				<div id="content-text">
				</div>
			</div>
			<div class="evaluate" id="evaluate">
				<div class="evaluate-title">评价</div>
				<div class="evaluate-content">
					<p class="statistics">
						<span ctype="1">全部(<font class="ctype">0</font>)</span>
						<span ctype="2">好评(<font class="ctype">0</font>)</span>
						<span ctype="3">中评(<font class="ctype">0</font>)</span>
						<span ctype="4">差评(<font class="ctype">0</font>)</span>
						<span ctype="5">有图(<font class="ctype">0</font>)</span>
					</p>
					<ul class="evaluate-list" id="evaluate-list">
						<!--<li class="evaluate-list-item">
							<p>
								<span class="user-name"><img src="../images/profile.png"/><font>匿名用户34324234324234324343243243243243243</font></span>
								<span class="user-star">
									<i class="mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon-starhalf"></i>
								</span>
								<span class="user-time">2017-01-01</span>
							</p>
							<p>
								分管控了数据顾客零食就赶快来数据打开感动死了就接口里金刚骷髅岛技术更抗裂砂浆啊分管控了数据顾客零食就赶
								快来数据打开感动死了就接口里金刚骷髅岛技术更抗裂砂浆啊分管控了数据顾客零食就赶快来数据打开感动死了就
								接口里金刚骷髅岛技术更抗裂砂浆啊分管控了数据顾客零食就赶快来数据打开感动死了就接口里金刚骷髅岛技术
								更抗裂砂浆啊分管控了数据顾客零食就赶快来数据打开感动死了就接口里金刚骷髅岛技术更抗裂砂浆啊
							</p>
							<p>
								<div class="user-photo">
									<img class="photos" data-preview-src="" data-preview-group="2"  src="../images/muwu.jpg"/>
									<img class="photos" data-preview-src="" data-preview-group="2" src="../images/shuijiao.jpg"/>
								</div>
							</p>
							<p class="reply">
								<span>客服123回复：</span>
								<span>就狂蜂浪蝶数据库里放假啊圣诞快乐接口里的数据罚款了的极乐空间撒德鲁克积分额就狂蜂浪蝶数据库里放假
									啊圣诞快乐接口里的数据罚款了的极乐空间撒德鲁克积分额就狂蜂浪蝶数据库里放假啊圣诞快乐接口里的数据罚款
									了的极乐空间撒德鲁克积分额就狂蜂浪蝶数据库里放假啊圣诞快乐接口里的数据罚款了的极乐空间撒德鲁克积分额</span>
							</p>
							<p class="zan">
								<span><img src="../images/ai.png"/> 0</span>	
								<span><img src="../images/zan.png"/> 0</span>	
							</p>
						</li>-->
					</ul>
					<!--<p class="evaluate-more" id="evaluate-more">查看全部评论</p>-->
				</div>
			</div>
		</div>
		<div id="no-content">
			<p><img src="../images/kuqi.png" /></p>
			<p id="no-content-text">很抱歉,此商品已下架或不存在!</p>
		</div>
		<nav class="mui-bar mui-bar-tab footer-bar" id="footerBar">
			<a id="consult">
				<span class="mui-icon mui-icon-phone"></span>
				<span class="mui-tab-label">咨询</span>
			</a>
			<a id="collect">
				<span class="mui-icon mui-icon-star" id="collect-icon"></span>
				<span class="mui-tab-label">收藏</span>
			</a>
			<a class="add-cart" id="add-cart">
				加入购物车
			</a>
			<a class="buy-now" id="buy-now">
				立即购买
			</a>
		</nav>
		<script type="text/javascript" src="../js/mui.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/common.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.lazyload.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.lazyload.img.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.zoom.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.previewimage.js" charset="UTF-8"></script>
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: false,
				pullRefresh: {
					container: '#detailcontent',
					up: {
						auto: true,
						height: 80,
						contentinit: '<font style="font-size:12px;color:#999">上拉查看更多评价</font>',
						contentdown: '<font style="font-size:12px;color:#999">上拉查看更多评价</font>',
						contentrefresh: '<font style="font-size:12px;color:#999">正在加载...</font>',
						contentnomore: '<font style="font-size:12px;color:#999">暂无更多评价!</font>',
						callback: function(){
							ajaxGetComments()
						}
					}
				}
			});

			honey.lastId = 0;
			honey.ctype = 1;
			honey.loadStatus = false;
//			honey.discount=100;//折扣率
			honey.d = {
				attrExpress: document.getElementById('attr-express'),
				id: document.getElementById('goods-id'),
				buyNum: document.getElementById('buy-num'),
				share: document.getElementById('share'),
				param: document.getElementById('param'),
				title: document.getElementById('goods_title'), //标题
				price: document.getElementById('shop_price'), //价格
				m_price: document.getElementById('market_price'), //市场价格
				spec: document.getElementById('spec'), //规格属性
				store: document.getElementById('store'),
				saleNum: document.getElementById('sale_num'),
				giveIntegral: document.getElementById('give_integral'),
				table: document.getElementById('goods-attr-table'),
				topSpan: document.getElementById('header').querySelectorAll('span'),
				topMenu: document.getElementById('header').querySelectorAll('span')[0],
				ctype: document.getElementsByClassName('ctype'),
				evaluate: document.getElementById('evaluate'),
				evaluateList: document.getElementById('evaluate-list'),
				//					evaluateMore:document.getElementById('evaluate-more'),
				header: document.getElementById('header'),
				remark: document.getElementById('remark'),
				goodsContent: document.getElementById('goods-content'),
				content: document.getElementById('content-text'),
				noContent: document.getElementById('no-content'),
				noContentTxt: document.getElementById('no-content-text'),
				detailcontent: document.getElementById('detailcontent'),
				collect: document.getElementById('collect'),
				consult: document.getElementById('consult'),
				collectIcon: document.getElementById('collect-icon'),
				addcart: document.getElementById('add-cart'),
				buynow: document.getElementById('buy-now'),
				points:document.getElementById('points'),
				price_ladder:document.getElementById('price-ladder'),
				ladder_list:document.getElementById('ladder-list')
			};
			honey.goods = {};
			honey.scrollMenu = true;
			honey.ajaxGetData = function() {
				mui.ajax(honey.apiurl, {
					data: {
						m: 'goods_info',
						goods_id: honey.goods.goods_id,
						token:honey.token
					},
					type: 'post',
					dataType: 'json',
					timeout: 60000,
					success: function(ret) {
						if(ret.code == 0) {
							//初始化显示
							honey.d.noContent.setAttribute('style', 'display:none')
							honey.d.header.setAttribute('style', '')
							honey.d.detailcontent.setAttribute('style', '')
							var data = ret.data;
							//标题
							honey.d.title.innerText = honey.goods.name = data.base.goods_name;
							//价格阶梯
							if(data.base.price_ladder){
								var ladder_html=[];
								mui.each(data.base.price_ladder, function(i,v) {
									ladder_html.push('<p class="goods-price">数量满<font>'+v.amount+'</font>时,价格为<font>￥'+v.price+'</font></p>');
								});
								if(ladder_html.length>0){
									honey.d.ladder_list.innerHTML=ladder_html.join('')
									honey.d.price_ladder.setAttribute('style','')
								}else{
									honey.d.ladder_list.innerHTML=''
									honey.d.price_ladder.setAttribute('style','display: none;')
								}
							}
							honey.goods.price_ladder=data.base.price_ladder;
							honey.goods.goods_sn=data.base.goods_sn;
							honey.goods.sku=data.base.sku;
							honey.goods.is_free_shipping=data.base.is_free_shipping;
							//收藏
							data.collect == 1 && honey.collectCallBack(1)
							//商品图片
							var img = [{
								src: honey.apihost + data.base.original_img
							}];
							mui.each(data.images, function(i, v) {
								if(v.image_url != data.base.original_img) {
									img.push({
										src: honey.apihost + v.image_url
									})
								}else{
									honey.goods.img=honey.apihost+'/public/upload/goods/thumb/'
									+honey.goods.goods_id+'/goods_sub_thumb_'+v.img_id+'_150_150.jpg';
								}
							});
							honey.imageSliderView.setImages(img)
							honey.imageSliderView.show()
							//是否有规格属性
							if(data.spec) {
								honey.spec_item = [];
								honey.goods.spec_name=[];
								var price_key = [];
								var spec_html = [];
								mui.each(data.spec, function(i, v) {
									var html = [];
									for(var j = 0; j < data.spec[i].length; j++) {
										var v = data.spec[i][j];
										v['spec']=i;
										honey.spec_item.push(v)
										if(j == 0) {
											price_key.push(v.item_id)
											honey.goods.spec_name.push('['+i+':'+v.item+']')
										}
										html.push('<button type="button" item_id="' + v.item_id + '" class="mui-btn' + (j == 0 ? ' mui-btn-active' : '') + '">' + v.item + '</button>');
									}
									spec_html.push('<p class="goods_spec"><span>' + i + '</span>' + html.join('') + '</p>')
								});
								var k = price_key.length > 1 ? price_key.join('_') : price_key[0];
								honey.goods.spec_key=k;
								honey.spec_price = data.spec_price;
								honey.goods.price = honey.spec_price[k].price; //价格
//								honey.goods.member_price=parseFloat(honey.goods.price)*honey.discount/100; //会员价
								honey.d.price.innerText = honey.goods.price;
								honey.d.m_price.innerText ="￥"+honey.goods.price;
								honey.d.store.innerText = honey.goods.store = honey.spec_price[k].store_count; //库存
								honey.d.spec.innerHTML = spec_html.join('');
								honey.d.spec.setAttribute('style', '')
							} else {
								honey.d.spec.setAttribute('style', 'display:none')
								honey.d.price.innerText = honey.goods.price = data.base.shop_price;
								honey.d.store.innerText = honey.goods.store = data.base.store_count;
							}
							if(honey.goods.store == 0) {
								honey.d.buyNum.value = 0
							}
//							honey.d.m_price.innerText="￥"+(data.base.market_price>0?data.base.market_price:data.base.shop_price);
							//销量
							honey.d.saleNum.innerText = data.base.sale_num;
							//积分
							honey.d.giveIntegral.innerText = data.base.give_integral;
							honey.d.points.innerText=honey.goods.exchange_integral=data.base.exchange_integral;
							//产品参数
							var goodsAttr = [];
							mui.each(data.attr, function(i, v) {
								goodsAttr.push('<tr><td>' + v.attr_name + '</td><td>' + v.attr_value + '</td></tr>');
							})
							honey.d.table.innerHTML = goodsAttr.join('');
							//评价
							mui.each(honey.d.ctype, function(i, v) {
								var num = data.comment ? data.comment['c' + i] : 0
								v.innerText = num;
								//									v.setAttribute('num',num)
							});
//								if(data.comment){
//									honey.commentMore=true;
//									honey.d.evaluateMore.innerText="查看全部评价";
//									data.comment.statistics&&(honey.d.c0.innerText=data.comment.statistics.c0);
//									data.comment.list&&showCommentList(data.comment.list,'evaluate-list',1);
//								}else{
//									honey.commentMore=false;
//									honey.d.c0.innerText=0;
//									honey.d.evaluateMore.innerText="此商品暂无评价";
//								}
							//简介
							honey.d.remark.innerText = data.base.goods_remark;
							//详情
							data.base.goods_content = honey.escape2Html(data.base.goods_content)
							honey.d.content.innerHTML = data.base.goods_content;
							var img = honey.d.content.querySelectorAll('img');
							if(img.length > 0) {
								mui.each(img, function(i, v) {
									var s = honey.apihost + v.getAttribute('src')
									v.setAttribute('src', s)
									v.setAttribute('data-preview-src', s)
									v.setAttribute('data-preview-group', 'content');
								});
								mui('#content-text').off('tap', 'img').on('tap', 'img', function() {
									mui.previewImage()
								})
							}
							setTimeout(ajaxGetComments, 10)
						} else if(ret.code == 2) { //商品不存在或以下架
							honey.getDataFailed()
						}
					},
					error: function(ret) {
//						alert(JSON.stringify(ret))
						honey.getDataFailed(1)
					}
				})
			}
			honey.getDataFailed = function(err) {
				honey.d.noContentTxt.innerText = err == 1 ? "很抱歉,网络不给力,请检查网络!" : "很抱歉,此商品已下架或不存在!";
				honey.d.noContent.setAttribute('style', '')
				honey.imageSliderView.hide()
				honey.d.header.setAttribute('style', 'display: none;')
				honey.d.detailcontent.setAttribute('style', 'display: none;')
			}
			honey.collectCallBack = function(is_true) {
				honey.d.collectIcon.setAttribute('class', is_true ? 'mui-icon mui-icon-star-filled has-collect' : 'mui-icon mui-icon-star')
			}

			function ajaxGetComments() {
				if(honey.loadStatus) {
					return false;
				}
				if(!honey.content) {
					honey.content = mui('#detailcontent')
				}
				if(honey.goods.goods_id) {
					honey.loadStatus = true;
					mui.ajax(honey.apiurl, {
						data: {
							m: 'goods_comments_list',
							goods_id: honey.goods.goods_id,
							last_id: honey.lastId,
							ctype: honey.ctype,
						},
						type: 'post',
						dataType: 'json',
						timeout: 60000,
						success: function(ret) {
							honey.loadStatus = false;
							if(ret.code == 0) {
								if(honey.lastId == 0) {
									honey.d.evaluateList.innerHTML = '';
								}
								ret.data.statistics && (honey.d.c0.innerText = ret.data.statistics.c0);
								honey.showCommentList(ret.list, 'evaluate-list', 1);
							}
							honey.content.pullRefresh().endPullupToRefresh((!ret.list || (ret.list && ret.list.length < 5)))
						},
						error: function(ret) {
							//							alert(JSON.stringify(ret))
						}
					})
				} else {
					honey.content.pullRefresh().endPullupToRefresh()
				}
			}
			
			/**
			 * 预加载提交订单
			 */
			honey.preloadBuyWin = function() {
//				if(!plus.webview.getWebviewById('buy')){
					//头部
					honey.buyHeader = mui.preload({
						id: 'buy',
						url: '../cart/buy-header.html',
						styles: {
							top: '0px',
							bottom: '0px',
						},
					})
					honey.buyHeader.hide()
			
					//内容
					honey.buyContent = mui.preload({
						id: 'buy-content',
						url: '../cart/buy-content.html',
						styles: {
							top: '44px',
							bottom: 0
						},
					})
					honey.buyContent.hide()
					honey.buyHeader.addEventListener('hide', function() {
						honey.buyContent.hide()
					})
					honey.buyHeader.addEventListener('show', function() {
						honey.buyContent.show()
					})
					honey.buyHeader.append(honey.buyContent)
//				}
			}
			
			
			mui.plusReady(function() {
				honey.token = myStorage.getItem('token')
//				if(honey.token&&(honey.user=myStorage.getItem('user'))){
//					honey.discount=parseInt(honey.user.level.discount)
//				}
				honey.fixFooter('footerBar')
				
				if(!honey.detailSubpage) {
					honey.detailSubpage = plus.webview.currentWebview();
				}
				
				/**
				 * 分享事件
				 */
				//				honey.d.share.addEventListener('tap',function(){
				//					mySrcollTo('evaluate',1,1)
				//				})

				/**
				 * 查看更多评论
				 */
				mui('.statistics').on('tap', 'span', function() {
					var ctype = this.getAttribute('ctype')
					var num = this.querySelector('font').innerText;
					if(ctype != honey.ctype && num > 0) {
						honey.ctype = ctype;
						//						honey.d.evaluateList.innerHTML='';
						honey.content.pullRefresh().refresh(true);
						honey.lastId = 0;
						ajaxGetComments()
					} else {
						honey.d.evaluateList.innerHTML = '';
						honey.content.pullRefresh().endPullupToRefresh(1)
					}
				})
				/**
				 * 收藏商品
				 */
				honey.d.collect.addEventListener('tap', function(e) {
					if(!honey.token) {
						honey.token = myStorage.getItem('token')
						if(!honey.token) {
							honey.openWin('../mine/login.html', 'login')
							e.stopPropagation();
						}
						return
					}
					mui.ajax(apiurl, {
						data: {
							m: 'collect_goods',
							goods_id: honey.goods.goods_id,
							token: honey.token
						},
						type: 'post',
						dataType: 'json',
						timeout: 60000,
						success: function(ret) {
							mui.toast(ret.msg)
							if(ret.code == 0) {
								honey.collectCallBack(ret.type == 1)
							}
						},
						error: function(ret) {
							//							alert(JSON.stringify(ret))
							//							mui.toast('失败')
						}
					})
				})

				/**
				 * 头部菜单事件
				 */
				mui('#header').on('tap', 'span', function() {
					honey.d.topMenu.className = '';
					this.className = "active";
					honey.d.topMenu = this;
					var index = this.getAttribute('index');
					switch(index) {
						case '1': //回到顶部
							honey.mySrcollTo()
							break;
						case '2': //详情
							honey.mySrcollTo('goods-content')
							break;
						case '3': //评论
							honey.mySrcollTo('evaluate')
							break;
					}
				})

				/**
				 * 选择规格事件
				 */
				mui('.choose-type').on('tap', '.mui-btn', function() {
					//判断是否已选择
					if(!this.hasClass('mui-btn-active')) {
						var p = this.parentElement.querySelectorAll('.mui-btn-active')[0];
						this.classList.add('mui-btn-active')
						p.classList.remove('mui-btn-active')
						var btn = mui('.mui-btn-active');
						var price_key = [];
						honey.goods.spec_name = [];
						mui.each(btn, function(i, v) {
							var item_id=v.getAttribute('item_id');
							for(var j=0;j<honey.spec_item.length;j++){
								if(honey.spec_item[j].item_id==item_id){
									price_key.push(item_id)
									honey.goods.spec_name.push('['+honey.spec_item[j].spec+':'+honey.spec_item[j].item+']')
									break;
								}
							}
						});
						var k = price_key.length > 1 ? price_key.join('_') : price_key[0];
						honey.goods.spec_key = k; //套餐
//						honey.goods.member_price=honey.fmoney(parseFloat(honey.spec_price[k].price)*honey.discount/100);//会员价
						honey.d.price.innerText = honey.goods.price = honey.spec_price[k].price; //价格
						honey.goods.store = honey.spec_price[k].store_count; //库存
						honey.d.m_price.innerText ="￥"+honey.goods.price;
						honey.d.store.innerText = honey.goods.store;
						if(honey.d.buyNum.value < honey.goods.store) {
							honey.d.buyNum.value == 0 && (honey.d.buyNum.value = 1);
						} else {
							honey.d.buyNum.value = honey.goods.store;
						}
					}
				})

				/**
				 * 选择数量事件
				 */
				honey.d.buyNum.addEventListener('change', function() {
					if(this.value < 1) {
						this.value = 1
					}
					if(this.value > honey.goods.store) {
						this.value = honey.goods.store
						if(honey.goods.store == 0) {
							mui.toast('该商品已售罄')
						}
					}
					honey.checkPrice(this.value)
				})
				
				honey.checkPrice=function(num){
//					honey.goods.member_price=honey.fmoney(parseFloat(honey.goods.price)*honey.discount/100); //会员价
					var ladder_price=false;
					if(honey.goods.price_ladder&&honey.goods.price_ladder.length>0){
						mui.each(honey.goods.price_ladder, function(i,v) {
							if(parseInt(num)>=parseInt(v.amount)){
								ladder_price=v.price; 
							}
						});
					}
					honey.d.price.innerText = ladder_price||honey.goods.price;
				}

				honey.d.attrExpress.addEventListener('tap', function() {
					plus.webview.currentWebview().setStyle({
						mask: "rgba(0,0,0,0.5)"
					});
					if(!honey.servicePage) {
						honey.servicePage = plus.webview.getWebviewById('service');
					}
					honey.servicePage.show('slide-in-bottom', 300)
				})
				/**
				 * 监听关闭商品详情事件
				 */
				window.addEventListener('closeDetail', function() {
					mui.previewImage().close();
				})
				
//				window.addEventListener('logout',function(){
//					honey.discount=100;
//				})
				
//				window.addEventListener('login',function(){
//					honey.user=myStorage.getItem('user')
//		    		if(honey.user&&honey.user.level.discount>0){
//		    			honey.discount=parseInt(honey.user.level.discount);
//		    		}
//				})
				/**
				 * 显示商品事件
				 */
				window.addEventListener('showGoods', function(o) {
					honey.goods = {};
					honey.goods.goods_id = o.detail.goods_id;
					honey.lastId = 0;
					honey.content.pullRefresh().refresh(true);
					if(!honey.goodsDetail) {
						honey.goodsDetail = plus.webview.currentWebview();
					}
					honey.goodsDetail.setStyle({
						mask: "none"
					})
					if(!honey.imageSliderView) {
						var data = {
							top: '0px',
							left: '0px',
							height: '220px',
							width: '100%',
							position: 'static',
							images: [{
								src: '../images/default.png'
							}]
						};
						honey.imageSliderView = new plus.nativeObj.ImageSlider('test', data);
						honey.goodsDetail.append(honey.imageSliderView);
					} else {
						honey.imageSliderView.setImages([{
							src: '../images/default.png'
						}]);
					}
					honey.mySrcollTo()
					honey.d.evaluateList.innerHTML = '';
					honey.d.content.innerHTML = '';
					honey.d.buyNum.value = 1;
					honey.collectCallBack()
					honey.ajaxGetData()
					honey.goodsDetail.show()
					honey.preloadBuyWin()
				})

				/**
				 * 滚动事件
				 */
				document.addEventListener('scroll', function() {
					if(honey.scrollMenu) {
						honey.scrollMenu = false;
						var h1 = window.innerHeight;
						var h = document.body.scrollTop + 220;
						var s1 = honey.d.goodsContent.offsetTop;
						var s2 = honey.d.evaluate.offsetTop;
						var i = 0;
						if(h >= s2) {
							i = 2;
						} else if(h >= s1) {
							i = 1;
						}
						honey.d.topMenu.className = '';
						honey.d.topMenu = honey.d.topSpan[i];
						honey.d.topMenu.className = "active";
						if((h + 220) > h1) {
							honey.d.header.setAttribute('style', '')
						} else {
							honey.d.header.setAttribute('style', 'display:none')
						}
						setTimeout(function() {
							honey.scrollMenu = true;
						}, 200)
					}
				})
				//加入购物车事件
				honey.d.addcart.addEventListener('tap', function() {
					//获取已经选择的商品
					var cart=myStorage.getItem('cart');
					honey.goods.num=parseInt(honey.d.buyNum.value);
					if(honey.goods.store>0){
						if(!cart){
							cart=[];
							cart.push(honey.goods)
						}else{
							var is_upd=false;
							for(var i=0;i<cart.length;i++){
								var v=cart[i];
								if(v.goods_id==honey.goods.goods_id){
									if((!honey.goods.spec_key && !v.spec_key) || (honey.goods.spec_key && v.spec_key && honey.goods.spec_key==v.spec_key)) {
										if(v.num<v.store){
											cart[i].num=parseInt(cart[i].num)+honey.goods.num;
											if(cart[i].num>cart[i].store){
												cart[i].num=cart[i].store;
											}
											is_upd=true;
											break;
										}else{
											mui.toast('购物车商品已达到库存上限')
											return
										}
									}
								}
							}
							if(!is_upd){
								cart.push(honey.goods)
							}
						}
						myStorage.setItem('cart',cart)
						if(!honey.show_success){
							mui.toast('加入购物车成功')
							honey.show_success=true;
							setTimeout(function(){
								honey.show_success=false
							},1500)
						}
					}else{
						mui.toast('该商品已售罄')
					}
				})
				
				honey.d.buynow.addEventListener('tap',function(){
					if(honey.goods.store==0){
						if(honey.goods.store==0){
							mui.toast('该商品已售罄')
						}
						return 
					}
					if(!honey.buyHeader){
						honey.preloadBuyWin()
					}
					honey.goods.num=parseInt(honey.d.buyNum.value);
					mui.fire(honey.buyContent,'showBuyList',[honey.goods])
        			honey.buyHeader.show('slide-in-right',300);
				})
				
				honey.swipeClose(window)
			})
		</script>
	</body>

</html>