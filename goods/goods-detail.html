<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>product-detail</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css"  />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../css/icons-extra.css" />
		<link rel="stylesheet" type="text/css" href="../css/own.css" />
		<link rel="stylesheet" type="text/css" href="../css/previewimage.css" />
		<link rel="stylesheet" type="text/css" href="../css/goods-detail.css" />
	</head>
	<body>
		<header class="mui-bar mui-bar-nav hide" id="header">
			<span class="active" index="1">商品</span> <span index="2">详情</span> <span index="3">评论</span> 
		</header>
		<div id="detailcontent" class="mui-content  detail-content-padding" style="padding-top: 220px;">
			<div id="attr">
				<div class="goods-title">
					<div class="fl title"><h5 id="goods_title">这里是标题这里是标题这里是这里是标题这里是标题这里是</h5></div>
					<div class="fr icon">
						<a href="#" id="share">
		                    <span class="mui-icon-extra mui-icon-extra-share fl"></span>
		                    <span class="fr share">分享</span>
		            	</a>
					</div>
				</div>
				<div class="goods-attr">
					<div class="price">
						<p class="goods-price goods-price-one"><span class="icon-money">￥</span><span id="shop_price">200</span></p>
						<p class="goods-price goods-price-two" id="market_price">价格 <span>￥300</span></p>
					</div>
					<div class="express">
						<p>
							<span>快递:<font>0.00</font></span>
							<span style="text-align: center;">销量:<font id="sale_num">123</font>笔</span>
							<span style="text-align: right;">库存:<font id="store">123</font></span>
						</p>
					</div>
				</div>
				<div class="user-do choose-type" id="spec">
					<!--<p>
					<span>套餐</span>
					<button type="button" class="mui-btn mui-btn-active">
						套餐一
					</button>
					<button type="button" class="mui-btn">
						套餐二
					</button>
					<button type="button" class="mui-btn">
						套餐三
					</button>
					<button type="button" class="mui-btn">
						套餐四
					</button>
					</p>-->
				</div>
				<div class="user-do" id="buy-number">
					<span>数量</span>
					<div class="mui-numbox">
						<button class="mui-btn mui-btn-numbox-minus" type="button">-</button>
						<input class="mui-input-numbox" type="number" min="1" max="100" id="buy-num"/>
						<button class="mui-btn mui-btn-numbox-plus" type="button">+</button>
					</div>					
				</div>
				<div class="preferential">
					<div class="service" id="attr-express">
						<p><span class="mui-icon mui-icon-checkmarkempty"></span>配送到家</p>
						<p><span class="mui-icon mui-icon-checkmarkempty"></span>药店自提</p>
						<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
					</div>
					<div class="service">
						<p class="point"><icon>积分</icon>购买可得<font id="give_integral">0</font>积分</p>
						<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
					</div>
				</div>
				<div class="parameter" id="param">
					<div class="attr-table">
						<div class="service">
							<p>规格参数</p>
							<!--<p class="icon fr"><span class="mui-icon mui-icon-arrowright"></span></p>-->
						</div>
						<table id="goods-attr-table">
						</table>
						
					</div>
				</div>
			</div>
			<div class="evaluate" id="evaluate">
				<div class="evaluate-title"><span class="mui-icon mui-icon-chatbubble"></span>评价</div>
				<div class="evaluate-content" id="evaluate-content">
					<ul class="evaluate-list">
						<li class="evaluate-list-item">
							<p>
								<span class="user-name"><img src="../images/profile.png"/><font>匿名用户</font></span>
								<span class="user-star">
									<i class="mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon-star-filled"></i>
									<i class="mui-icon mui-icon-starhalf"></i>
								</span>
								<span class="user-time">2017-01-01</span>
							</p>
							<p>
								分管控了数据顾客零食就赶快来数据打开感动死了就接口里金刚骷髅岛技术更抗裂砂浆啊分管控了数据顾客零食就赶
								快来数据打开感动死了就接口里金刚骷髅岛技术更抗裂砂浆啊分管控了数据顾客零食就赶快来数据打开感动死了就
								接口里金刚骷髅岛技术更抗裂砂浆啊分管控了数据顾客零食就赶快来数据打开感动死了就接口里金刚骷髅岛技术
								更抗裂砂浆啊分管控了数据顾客零食就赶快来数据打开感动死了就接口里金刚骷髅岛技术更抗裂砂浆啊
							</p>
							<p>
								<div class="user-photo">
									<img class="photos" data-preview-src="" data-preview-group="2"  src="../images/muwu.jpg"/>
									<img class="photos" data-preview-src="" data-preview-group="2" src="../images/shuijiao.jpg"/>
								</div>
							</p>
							<p class="evaluate-more">查看全部评论</p>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<nav class="mui-bar mui-bar-tab footer-bar">
			<a>
				<span class="mui-icon mui-icon-chat"></span>
				<span class="mui-tab-label">咨询</span>
			</a>
			<a>
				<span class="mui-icon mui-icon-star"></span>
				<span class="mui-tab-label">收藏</span>
			</a>
			<a class="add-cart">
				加入购物车
			</a>
			<a class="buy-now">
				立即购买
			</a>
		</nav>
		<script type="text/javascript" src="../js/mui.min.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/common.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.zoom.js" charset="UTF-8"></script>
		<script type="text/javascript" src="../js/mui.previewimage.js" charset="UTF-8"></script>
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: false,
//				subpages:[{
//					url:'goods-detail-bottom.html',
//					id:'goods-detail-bottom',
//					styles:{
//						bottom:0,
//						height:'51px',
//						bounceBackground:'#f8f8f8'
//					}
//				}]
			});
			var honey={
				d:{
					attrExpress:document.getElementById('attr-express'),
					id:document.getElementById('goods-id'),
					buyNum:document.getElementById('buy-num'),
					share:document.getElementById('share'),
					param:document.getElementById('param'),
					title:document.getElementById('goods_title'),//标题
					price:document.getElementById('shop_price'),//价格
					m_price:document.getElementById('market_price'),//市场价格
					spec:document.getElementById('spec'),//规格属性
					store:document.getElementById('store'),
					giveIntegral:document.getElementById('give_integral'),
					table:document.getElementById('goods-attr-table'),
					topMenu:document.getElementById('header').querySelectorAll('span')[0],
				},
				goods:{},
				ajaxGetData:function(){
					mui.ajax(apiurl,{
					data:{m:'goods_info',goods_id:honey.goods.goods_id},
					type:'post',
					dataType:'json',
					success:function(ret){ 
						if(ret.code==0){
							var data=ret.data;
							//标题
							honey.d.title.innerText=data.base.goods_name;
							//商品图片
							var img=[{src:apihost+data.base.original_img}];
							mui.each(data.images, function(i,v) {
								if(v.image_url!=data.base.original_img){
									img.push({src:apihost+v.image_url})
								}
							});
							honey.imageSliderView.setImages(img)
							//是否有规格属性
							if(data.spec){
								var price_key=[];
								var spec_html=[];
								mui.each(data.spec, function(i,v) {
									var html=[];
									for(var j=0;j<data.spec[i].length;j++){
										var v=data.spec[i][j];
										if(j==0){
											price_key.push(v.item_id)
										}
										html.push('<button type="button" item_id="'+v.item_id+'" class="mui-btn'+(j==0?' mui-btn-active':'')+'">'+v.item+'</button>');
									}
									spec_html.push('<p class="goods_spec"><span>'+i+'</span>'+html.join('')+'</p>')
								});
								var k=price_key.length>1?price_key.join('_'):price_key[0];
								honey.spec_price=data.spec_price;
								honey.d.price.innerText=honey.goods.price=honey.spec_price[k].price;//价格
								honey.d.store.innerText=honey.goods.store=honey.spec_price[k].store_count;//库存
								honey.d.spec.innerHTML=spec_html.join('');
								honey.d.spec.setAttribute('style','')
							}else{
								honey.d.spec.setAttribute('style','display:none')
								honey.d.price.innerText=honey.goods.price=data.base.shop_price;
								honey.d.store.innerText=honey.goods.store=data.base.store_count;
							}
							if(honey.goods.store==0){
								honey.d.buyNum.value=0
							}
							//积分
							honey.d.giveIntegral.innerText=data.base.give_integral;
							var goodsAttr=[];
							mui.each(data.attr,function(i,v){
								goodsAttr.push('<tr><td>'+v.attr_name+'</td><td>'+v.attr_value+'</td></tr>');
							})
							honey.d.table.innerHTML=goodsAttr.join('');
							//
							
						}else if(ret.code==2){
							mui.toast(ret.msg)
						}
					},
					error:function(ret){
						alert(JSON.stringify(ret))
						mui.toast('数据加载失败')
					} 
				})
				}
			};
			mui.plusReady(function(){
				honey.d.share.addEventListener('tap',function(){
					mySrcollTo('attr',1,1)
//					var y=document.getElementById('attr').clientHeight+220;
//					mui.scrollTo(y,1);
				})
				
				mui('#header').on('tap','span',function(){
					honey.d.topMenu.className='';
					this.className="active";
					honey.d.topMenu=this;
					var index=this.getAttribute('index');
					switch(index){
						case '1'://回到顶部
							mySrcollTo()
							break;
						case '2':
							mySrcollTo('param')
							break;
						case '3':
							mySrcollTo('attr')
							break;
					}
				})
				
				mui('.user-photo').on('tap','img',function(){
					mui.previewImage()
				})
				
				mui('.choose-type').on('tap','.mui-btn',function(){
					//判断是否已选择
					if(!this.hasClass('mui-btn-active')){
						var p=this.parentElement.querySelectorAll('.mui-btn-active')[0];
						this.classList.add('mui-btn-active')
						p.classList.remove('mui-btn-active')
						var btn=mui('.mui-btn-active');
						var price_key=[];
						mui.each(btn, function(i,v) {
							price_key.push(v.getAttribute('item_id'))
						});
						var k=price_key.length>1?price_key.join('_'):price_key[0];
						honey.goods.price=honey.spec_price[k].price;//价格
						honey.goods.store=honey.spec_price[k].store_count;//库存
						honey.d.price.innerText=honey.goods.price;
						honey.d.store.innerText=honey.goods.store;
						if(honey.goods.store==0){
							honey.d.buyNum.value=0
						}else{
							honey.d.buyNum.value==0&&(honey.d.buyNum.value=1);
						}
					}
				})
				
				honey.d.buyNum.addEventListener('change',function(){
					if(this.value<1){
						this.value=1
					}
					if(this.value>honey.goods.store){
						this.value=honey.goods.store
					}
				})
			})
			window.addEventListener('showGoods',function(o){
				honey.goods.goods_id=o.detail.goods_id;
				if(!honey.goodsDetail){
					honey.goodsDetail=plus.webview.currentWebview();
				}
				if(!honey.imageSliderView){
					var data={
						top:'0px',
						left:'0px',
						height:'220px',
						width:'100%',
						position:'static',
						images:[{src:'../images/default.png'}]
					};
					honey.imageSliderView = new plus.nativeObj.ImageSlider('test',data);
					honey.goodsDetail.append(honey.imageSliderView);
				}else{
					honey.imageSliderView.setImages([{src:'../images/default.png'}]);
				}
				mySrcollTo()
//				mui.scrollTo(0,10);
				honey.d.buyNum.value=1;
				honey.ajaxGetData()
				honey.goodsDetail.show()
			})
			
		</script>
	</body>

</html>