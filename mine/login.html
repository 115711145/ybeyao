<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>E3不是父子模版，考虑其为模态视图</title>
		<link rel="stylesheet" type="text/css" href="../css/mui.min.css" />
		<link rel="stylesheet" type="text/css" href="../css/iconfont.css" />
		<link rel="stylesheet" type="text/css" href="../css/own.css" />
		<link rel="stylesheet" type="text/css" href="../css/register.css" />
	</head>

	<body>

		<header class="mui-bar mui-bar-nav own-main-background-color">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title" id="header-title">登录</h1>
		</header>
		<div class="mui-content">
			<div class="logo">
				<span ><img src="../images/logo.png"/></span>
			</div>
			<div class="mui-card">
				<form class="mui-input-group">
					<div class="mui-input-row">
						<label><img src="../images/zhanghao.png"/></label>
						<input type="text" id="mobile" class="mui-input-clear" value="" placeholder="手机号" />
					</div>
					<div class="mui-input-row">
						<label><img src="../images/pwd.png"/></label>
						<input type="password" id="pwd" class="mui-input-clear" value="" placeholder="密码" />
					</div>
				</form>
			</div>
			<div class="mui-button-row login">
				<button type="button" id="submit" class="mui-btn mui-btn-green mui-btn-block">登录</button>
			</div>
			<div class="mui-button-row regpwd">
				<button id="register" type="button" class="mui-btn mui-btn-link">快速注册</button>
				<button id="repsd" type="button" class="mui-btn mui-btn-link">忘记密码</button>
			</div>
			<div class="third">
				<p class="line"><span class="fl"></span>第三方账号登录<span class="fr"></span></p>
				<p class="icon" id="wxdl"><span class="mui-icon mui-icon-weixin"></span></p>
				
			</div>
		</div>

		<script src="../js/mui.min.js" charset="UTF-8"></script>
		<script src="../js/common.js" charset="UTF-8"></script>
		<script src="../js/jsencrypt.js" charset="UTF-8"></script>
		<script type="text/javascript" charset="UTF-8">
			mui.init({
				swipeBack: true
			});
			honey.d={
				pwd:document.getElementById('pwd'),
				mobile:document.getElementById('mobile')
			};
			honey.bindEvent=function(){
				/**
				 * 登录按钮事件
				 */
				document.getElementById('submit').addEventListener('tap',function(){
					var phone=isPhone(honey.d.mobile.value)
					if(!phone){
						mui.toast('手机号码错误');
						return
					}
					if(!honey.logining){
						honey.logining=true;
						var that=this;
						that.setAttribute('style','background: #ccc;border: 1px solid #ccc;')
						mui.ajax(apiurl,{
							data:{
								m:'login',
								type:1,
								mobile:honey.d.mobile.value,
								password:encryptString(honey.d.pwd.value),
								system:honey.systemInfo.name,
								system_model:honey.deviceInfo.model,
								system_version:honey.systemInfo.version,
								resolution:honey.deviceInfo.screen,
								imei:honey.deviceInfo.imei,
								app_version:plus.runtime.version
							},
							type:'post',
							dataType:'json',
							success:function(ret){
								if(ret.code==0){
									mui.toast('登录成功',{duration:1000})
									that.setAttribute('style','')
									localStorage.setItem('token',ret.data.token);
									mui.fire(honey.indexWin, 'login')
									//触发登录事件
									//关闭注册和登录窗口
									closeWin('login',1000)
									closeWin('register')
								}else{
									mui.toast(ret.msg||'登录失败')
								}
								honey.logining=false;
							},
							error:function(ret){
//								alert(JSON.stringify(ret))
//								mui.toast('登录失败')
							}
						})
						
					}
				})
				/**
				 * 注册按钮事件
				 */
				document.getElementById('register').addEventListener('tap',function(){
					openWin('register.html','register')
				})
				
				/**
				 * 忘记密码事件
				 */
				document.getElementById('repsd').addEventListener('tap',function(){
					openWin('forgot.html','forgot')
				})
				
				/**
				 * 微信登录事件
				 */
				document.getElementById('wxdl').addEventListener('tap',function(){
					alert('微信登录')
				})
			}
			mui.plusReady(function(){
				getSysInfo()
				getDeviceInfo()
				honey.bindEvent()
				if(!honey.loginWin){
					honey.loginWin=plus.webview.currentWebview();
				}
				if(!honey.indexWin){
					honey.indexWin= plus.webview.getLaunchWebview(); 
				}
			})
			
		</script>
	</body>

</html>