<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
    <script src="js/mui.min.js"></script>
    <link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
   	<link rel="stylesheet" type="text/css" href="css/own.css"/>
   	<link rel="stylesheet" type="text/css" href="css/iconfont.css"/>
   	<style type="text/css">
   		html,body{background-color: #efeff4;}
		.mui-active .mui-icon,
		.mui-active .mui-tab-label {
			color: #41cea9;
		}
		#nav-title{
			display: none;
		}
		input[type='search']
		{
			color: #fff;
		    background-color: none;
		}
		.mui-search:before{
			color: #fff;
		}
		.mui-search .mui-placeholder
		{
		    color: #fff;
		}
		.mui-search .mui-placeholder .mui-icon
		{
		    color: #fff;
		}
		.mui-input-row .mui-input-speech ~ .mui-icon-speech {
			color: #fff;
		}
   	</style>
</head>
<body class="own-gray-color">
	<header class="mui-bar mui-bar-nav own-main-background-color">
		<div class="mui-input-row mui-search" id="search">
			<input type="search" readonly="readonly" disabled="disabled" id="search-input" class="mui-input-clear" placeholder="友邦大药房">
		</div>
		<h1 id="nav-title" class="mui-title"></h1>
	</header>
	<nav class="mui-bar mui-bar-tab" id="footerBar">
		<a class="mui-tab-item mui-active" id="home">
			<span class="mui-icon iconfont icon-home"></span>
			<span class="mui-tab-label">首页</span>
		</a>
		<a class="mui-tab-item" id="category">
			<span class="mui-icon iconfont icon-fenlei"></span>
			<span class="mui-tab-label">分类</span>
		</a>
		<!--<a class="mui-tab-item" id="message">
			<span class="mui-icon mui-icon-chat"></span>
			<span class="mui-tab-label">消息</span>
		</a>-->
		<a class="mui-tab-item" id="cart">
			<span class="mui-icon iconfont icon-cart"></span>
			<span class="mui-tab-label">购物车</span>
		</a>
		<a class="mui-tab-item" id="mine">
			<span class="mui-icon iconfont icon-wode"></span>
			<span class="mui-tab-label">我的</span>
		</a>
	</nav>
	<script type="text/javascript" src="js/mui.min.js" charset="UTF-8"></script>
	<script type="text/javascript" src="js/common.js" charset="UTF-8"></script>
	<script type="text/javascript" charset="UTF-8">
		(function(win,h,$,d,ms){
			$.init({
				preloadLimit:20
			})
			h.barItem=['home','mine'];
			h.barWebViews=[];
			h.contentStyle={top:'45px',bottom:'51px',scrollIndicator:'none'};
			h.d={
				title:document.getElementById('nav-title'),//标题
				search:document.getElementById('search'),
				cart:document.getElementById('cart')
			},
			//初始化所有bar页面
		    h.initWebViews=function(){
		    	//预加载页面
				h.preloadWebViews()
				//设置状态栏颜色
				plus.navigator.setStatusBarBackground( "#41cea9" );
				//设置只支持竖屏幕显示
				plus.screen.lockOrientation("portrait-primary");
				//绑定菜单事件
				h.bindBaritem()
				//搜索框事件
				$('header').on('click','#search',function(){
					alert('aa')
				})
			}
			h.preloadDetailView=function(){
				//加载详情页
				h.preloadGoodsDetail()
				//加载列表页
				h.preloadGoodsListWin()
				//加载购物车
				h.preloadCartWin()
				//预加载分类
				h.cateWin=h.preloadWin('barItem/category.html','category')
			}
			h.preloadWebViews=function(){//预加载页面
				h.mainWebview = plus.webview.currentWebview();
				for (var i = 0; i < h.barItem.length; i++) {
					var id=h.barItem[i];
					h.barWebViews[id] = mui.preload({
						id:id,
						url:'barItem/'+id+'.html',
						styles:{
							top:'44px',
							bottom: '51px',
							left: '0px',
							bounce: 'vertical',
							bounceBackground: '#f8f8f8',
							scrollIndicator:'none'
						},
						waiting:{
							autoShow:false
						}
					});
					h.barWebViews[id].hide();
					h.mainWebview.append(h.barWebViews[id]);
				}
				h.barWebViews[h.barItem[0]].show();
				h.curBarItemWebview = h.barItem[0];
			}
			h.showBarItemPage=function(id,e){
				if(id=='cart'){
					$.fire(honey.cartContent,"showCart")
					h.cartHeader.show('slide-in-right',300)
					e&&e.stopPropagation()
					return
				}
				if(id=='category'){
					h.cateWin.show('slide-in-right',300)
					e&&e.stopPropagation()
					return
				}
				var dom=document.getElementById(id);
				if(id!=h.curBarItemWebview){
					//更换标题
					if(id=='home'){
						h.d.search.style.display="block";
						h.d.title.style.display="none";
					}else{
						if(id=="mine"){
							if(!h.token){
//									document.getElementById('#'+h.curBarItemWebview)
								h.openWin('mine/login.html','login')
								e&&e.stopPropagation()
								return
							}else{
								$.fire(h.barWebViews[id],'reloadUser',{time:true})
							}
//						}else if(id=="cart"){
//							$.fire(h.barWebViews[id], 'showCart')
						}
						if(h.curBarItemWebview=='home'){
							h.d.search.style.display="none";
							h.d.title.style.display="block";
						}
						h.d.title.innerText = dom.querySelector('.mui-tab-label').innerText;
//							h.curBarItemWebview = h.barItem[id];
					}
					document.getElementById(h.curBarItemWebview).setAttribute('class','mui-tab-item')
					dom.setAttribute('class','mui-tab-item mui-active')
					//切换baritemwebview
					h.curBarItemWebview = id;
//					h.barWebViews[id].show(id=="cart"?"slide-in-right":'');
					h.barWebViews[id].show();
				}
			}
			h.bindBaritem=function(){//绑定菜单事件
				$('#footerBar').on('tap','.mui-tab-item',function(e){
					h.showBarItemPage(this.getAttribute('id'),e)
				});
			}
			$.plusReady(function(){
				if(!h.home){
					h.home=plus.webview.currentWebview();
				}
	//			myStorage.removeItem('token')
				h.token=myStorage.getItem('token')
				d.getElementById('footerBar').style.top = (plus.display.resolutionHeight - 51) + "px";
				h.initWebViews()
				h.preloadDetailView()
				
				win.addEventListener('goHome',function(){
					h.showBarItemPage('home')
				},false)
				
				win.addEventListener('login',function(o){
					h.token=myStorage.getItem('token')
					if(o.detail.show){
						h.showBarItemPage('mine')
					}
				},false)
				
				win.addEventListener('logout',function(){
					h.token=null;
				},false)
				
				win.addEventListener('showCart',function(){
					h.showBarItemPage('cart')
				},false)
			})
		}(window,honey,mui,document,myStorage))

	</script>
</body>
</html>